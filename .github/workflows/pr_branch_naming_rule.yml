name: PR and branch naming rule checker

on:
  pull_request:
    branches: [ master ]
    types: [ opened, edited, synchronize, reopened ]

jobs:
  naming_rule:
    runs-on: ubuntu-latest
    outputs:
      status: ${{ steps.set_output.outputs.status }}
    steps:

      - name: PR title checker
        uses: deepakputhraya/action-pr-title@master
        with:
          regex: '^(((feature|hotfix|fix)\/){1}(((NINJAMA|ninjama|NINJAFE|ninjafe){1}-[0-9]{1,}.{1,}))|((nonjira|NONJIRA){1}-.{1,}))|^((version|release)\/){1}(((v|V){1}[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}_.{1,}))$'
          github_token: ${{ secrets.TOKEN }}

      - name: PR title checker
        uses: deepakputhraya/action-branch-name@master
        with:
          regex: '^(((feature|hotfix|fix)\/){1}(((NINJAMA|ninjama|NINJAFE|ninjafe){1}-[0-9]{1,}.{1,}))|((nonjira|NONJIRA){1}-.{1,}))|^((version|release)\/){1}(((v|V){1}[0-9]{1,}\.[0-9]{1,}\.[0-9]{1,}_.{1,}))$'
          ignore: master

      - name: Slack Notification Successful
        if: ${{ steps.set_output.outputs.status == 'success' }}
        uses: edge/simple-slack-notify@master
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
        with:
          status: ${{ job.status }}
          text: 'Successful' 
          color: 'good'
          fields: |
            [{ "title": "Branch and PR title checker", "value": PR and Branch naming rule checker was succesful, "short": true }]

      - name: Slack Notification Failed
        if: ${{ steps.set_output.outputs.status != 'success' }}
        uses: edge/simple-slack-notify@master
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
        with:
          status: ${{ job.status }}
          text: 'Failed'
          color: 'danger'
          fields: |
            [{ "title": "Branch and PR title Failed", "value": PR and Branch naming rule checker was failed, "short": true }]
